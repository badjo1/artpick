<div class="continuum-container">
  <header class="page-header">
    <h1>Select Your Top 5</h1>
    <p class="text-secondary mt-sm">
      <%= @exhibition.title %>
    </p>
    <p class="text-secondary mt-xs">
      You've completed <%= @comparisons_count %> comparisons
    </p>
  </header>

  <%= form_with url: preferences_exhibition_path(@exhibition), method: :post, data: { controller: 'preferences' } do |f| %>
    <div class="selection-counter-wrapper">
      <div class="selection-counter">
        Selected: <span data-preferences-target="count">0</span> / 5
      </div>
    </div>

    <div class="artwork-grid">
      <% @top_artworks.each do |artwork| %>
        <label class="artwork-card artwork-selectable">
          <input type="checkbox"
                 name="artwork_ids[]"
                 value="<%= artwork.id %>"
                 class="artwork-checkbox"
                 data-preferences-target="checkbox"
                 data-action="change->preferences#updateSelectionCount"
                 <%= "checked" if @current_preferences.any? { |p| p.artwork_id == artwork.id } %>>

          <% if artwork.file.attached? %>
            <%= image_tag artwork.file, class: "artwork-image", alt: artwork.title %>
          <% end %>

          <div class="artwork-info">
            <h3><%= artwork.title %></h3>
            <% if artwork.artist %>
              <div class="artwork-artist"><%= artwork.artist.name %></div>
            <% end %>
            <div class="artwork-rank">Rank #<%= artwork.position %> • ELO <%= artwork.elo_score.round %></div>
          </div>

          <div class="selection-badge">
            ✓
          </div>
        </label>
      <% end %>
    </div>

    <div class="preferences-actions">
      <%= link_to "← Back to Voting", comparison_exhibition_path(@exhibition), class: "btn" %>
      <%= f.submit "Save Top 5", class: "btn btn-primary", data: { preferences_target: 'submitBtn' }, disabled: true %>
    </div>
  <% end %>
</div>
